<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>南华大学核电舆情系统</title>
    <link href="css/MGYQ.css" rel="stylesheet" type="text/css"  />
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css"  />


    <!--在线jq-->
    <script src="js/jquery-3.1.1.js" ></script>
    <script src="js/bootstrap.js" ></script>

    <script src="js/examples.js"></script>


    <!--加载数据表-->
    <script type="text/javascript">

        var operate=["查看","导出","邮箱发送"];
        var IMGroot={"weibo":"image/weibo.png"};
        var sum=5;//最大页数5;
        var barsum=10;//最大条目数2;
        var pagesum;//总共有的页数
        var curpage=1;//当前页


        function initData(start,dataroot,tparent)
        {

            curpage=start;
            $.ajax
            ({
                type: "get",
                dataType: "json",
                url: dataroot,
                data:{"curpage":curpage},
                success: function (data)
                {

                    sjk(data[0].all);


                    //获取ul节点
                    pagesum=parseInt(data[0].sum/barsum);
                    pagesum+=(data[0].sum%barsum?1:0);
                    var parent=document.getElementById(tparent);//获取对应模块
                    parent=parent.getElementsByTagName("ul");
                    parent=parent[0];


                    //清除节点
                    while(parent.hasChildNodes())parent.removeChild(parent.firstChild);
                    //先清除所有节点


                    // 加入<<节点
                    var son1=document.createElement("li");
                    var son2=document.createElement("a");
                    son2.setAttribute("href","#");
                    son2.innerHTML="&laquo;";
                    if((pagesum-curpage+1)<sum)
                    {
                        start=(pagesum-sum+1);
                        if(start<=0){start=1;}
                    }

                    //确定开始标号范围.
                    if(start-1>0)
                    {
                        son2.addEventListener("click",function () {
                            initData(start-1,dataroot,tparent);
                        });
                    }
                    son1.appendChild(son2);
                    parent.appendChild(son1);

                    var i;
                    for(i=start,DEF=0;DEF<sum&&i<=pagesum;i++,DEF++)//创建导航条,DEF为计数器
                    {
                        var son1=document.createElement("li");
                        var son2=document.createElement("a");
                        son2.setAttribute("href","#");
                        son2.innerText=i;
                        son2.addEventListener("click",function ()
                        {
                            initData(this.innerText,dataroot,tparent);
                        });
                        son1.appendChild(son2);
                        parent.appendChild(son1);
                    }

                    // 加入>>号
                    son1=document.createElement("li");
                    son2=document.createElement("a");
                    son2.setAttribute("href","#");
                    son2.innerHTML="&raquo;";

                    if(i<=pagesum)
                    {
                        son2.addEventListener("click",function ()
                        {
                            initData(i,dataroot,tparent);
                        });
                    }

                    //组装
                    son1.appendChild(son2);
                    parent.appendChild(son1);


                    var parent2=document.getElementById(tparent);
                    parent2=parent2.getElementsByTagName("div");
                    parent2=parent2[0];


                    while(parent2.hasChildNodes())parent2.removeChild(parent2.firstChild);

                    //加载每页上的数据
                    for(i=barsum*(curpage-1)+1,DEF=0;DEF<barsum&&i<=data[0].now;i++,DEF++)
                    {


                        //创建面板
                        var div1=document.createElement("div");
                        div1.setAttribute("class","panel panel-primary");


                        //加入标题
                        var div2=document.createElement("div");
                        var div2input=document.createElement("input");
                        div2input.setAttribute("type","checkbox");
                        div2input.setAttribute("name",tparent+"cb");

                        div2.appendChild(div2input);
                        div2.setAttribute("class","panel-heading");
                        div2.style.setProperty("font-weight","bold");
                        div2.innerHTML+=" "+data[i].title;

                        //加入内容
                        var div3=document.createElement("div");
                        div3.setAttribute("class","panel-body");
                        div3.innerText=data[i].context;

                        //加入来源
                        var div4=document.createElement("div");
                        div4.setAttribute("class","panel-footer");

                        div4.innerHTML="[相似文章数]"+data[i].relative+"   "+
                                       "[采集自] "+data[i].comfrom+"<img "+"src='"+IMGroot[data[i].comfrom]+"'"+">"+"</img>"+"    "+
                                       "[发布时间] "+data[i].time;

                        console.log(IMGroot[data[i].comfrom]);



                        //加入隐藏id
                        var div5=document.createElement("div");
                        div5.style.setProperty("display","none");
                        div5.innerText=data[i].id;

                        div1.appendChild(div2);
                        div1.appendChild(div3);
                        div1.appendChild(div4);
                        div1.appendChild(div5);

                        parent2.appendChild(div1);

                    }



                }
            });

        }

    </script>

    <!--全选事件-->
    <script type="text/javascript">
        function allseleck(papername)
        {


            var parent=document.getElementById(papername);
            parent=parent.getElementsByTagName("input");


            for(var i=0;i<parent.length;i++)
            {
                parent[i].checked=true;
            }
        }

    </script>

    <script type="text/javascript">
        function displaySubMenu(li) {
            var subMenu = li.getElementsByTagName("ul")[0];
            subMenu.style.display = "block";
        }
        function hideSubMenu(li) {
            var subMenu = li.getElementsByTagName("ul")[0];
            subMenu.style.display = "none";
        }
    </script>


    <script type="text/javascript">
        //写在布告板的函数
        function sjk(allsum)
        {
            var parent=document.getElementById("billboard");
            parent.innerText="系统数据库实时更新中,当前数据约有"+allsum+"条记录  "+"当前第"+curpage+"页";
        }

    </script>

</head>

<body onload="initData(1,'json/MGYQ.json','jryq')">

<!--Tbar-->
<div class="Tbar">
    <span>今日总量:</span>&nbsp;<span id="tValue">68754</span>
    <span>敏感:</span>&nbsp;<span id="mValue">230</span>
    <span>非敏感:</span>&nbsp;<span id="nValue">66524</span>
    <span>敏感比重:</span>&nbsp;<span id="iValue">3.4%</span>


    <div class="rfloat">
        <span>时间设定:</span>
        <span><a href="#">今天</a></span>
        &nbsp;
        <span><a href="#">本周</a></span>
        &nbsp;
        <span><a href="#">本月</a></span>

        <span><a href="#">时间自定义</a></span>
    </div>
</div>

<!--header-->
<div class="Header">
    <div class="Welcome">
        <span>欢迎 <span class="glyphicon glyphicon-user"></span></span>
        <span id="User">***</span>
        <span id="CandL"><a href="#">改密码<span class="glyphicon glyphicon-hand-left"></span></a>|<a href="#">退出<span class="glyphicon glyphicon-off"></span></a></span>
    </div>
</div>

<!--导航栏-->

<div class="bar-title">

    <div class="bar-status"><a href="SY.html">首页</a></div>
    <div class="bar-status" id="nav" onMouseOver="displaySubMenu(this)" onMouseOut="hideSubMenu(this)">
        <a href="#">舆情分析<span class="caret"></span></a>
        <ul class="nav-block">
            <li><a href="MTFX.html">媒体分析</a></li>
            <li><a href="QGFX.html">情感分析</a></li>
        </ul>
    </div>
    <div class="bar-status"><a href="#">伪舆情分析</a></div>
    <div class="bar-status"><a href="YQYJ.html">舆情预警</a></div>
    <div class="bar-status"  onMouseOver="displaySubMenu(this)" onMouseOut="hideSubMenu(this)">
        <a href="#">舆情报表<span class="caret"></span></a>
        <ul class="nav-block">
            <li><a href="TP.html">时间报表</a></li>
            <li><a href="SP.html">事件报表</a></li>
        </ul>

    </div>
    <div class="bar-status bar-status2"><a href="#">后台管理<span class="glyphicon glyphicon-asterisk"></span></a></div>
</div>

<!--主体-->
<div class="container" id="pointnewyq">
    <div class="row">
        <!--Nav tabs-->
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#jryq" aria-controls="jryq" role="tab" data-toggle="tab" onclick="initData(1,'json/MGYQ.json','jryq')">今日全部舆情</a></li>
            <li role="presentation"><a href="#mgyq" aria-controls="mgyq" role="tab" data-toggle="tab" onclick="initData(1,'json/MGYQ.json','mgyq')">今日敏感舆情</a></li>
            <li role="presentation"><a href="#fmgyq" aria-controls="fmgyq" role="tab" data-toggle="tab" onclick="initData(1,'json/MGYQ.json','fmgyq')">今日非敏感舆情</a></li>

        </ul>

        <!--Tab panes-->

        <div class="tab-content">
            <!--日报中心-->
            <div role="tabpanel" class="tab-pane active" id="jryq" style="padding-top:10px" >
                <div>

                </div>

                <ul class="pagination pagsize">


                </ul>
                <div style="float: right">
                    <button type="button" class="btn btn-default" onclick="allseleck('jryq')">全选</button>
                    <button type="button" class="btn btn-default">邮件发送</button>
                    <button type="button" class="btn btn-default">导出</button>
                </div>


            </div>
            <!--周报中心-->
            <div role="tabpanel" class="tab-pane" id="mgyq" style="padding-top:10px" >

                <div>

                </div>

                <ul class="pagination pagsize">



                </ul>

                <div style="float: right">
                    <button type="button" class="btn btn-default" onclick="allseleck('mgyq')">全选</button>
                    <button type="button" class="btn btn-default">邮件发送</button>
                    <button type="button" class="btn btn-default">导出</button>
                </div>


            </div>
            <!--月报中心-->
            <div role="tabpanel" class="tab-pane" id="fmgyq"  style="padding-top:10px" >
                <div>

                </div>

                <ul class="pagination pagsize">

                </ul>

                <div style="float: right" onclick="allseleck('fmgyq')">
                    <button type="button" class="btn btn-default">全选</button>
                    <button type="button" class="btn btn-default">邮件发送</button>
                    <button type="button" class="btn btn-default">导出</button>
                </div>

            </div>


        </div>

    </div>

        <!--公示-->
        <div style="float:right;" id="billboard">

        </div>

</div>





<!--foot-->
<div class="foot"> <span class="glyphicon glyphicon-copyright-mark"></span>all right by usc</div>



</body>
</html>
